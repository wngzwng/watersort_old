> 目的：探索在水排序中，等价类的定义和等价类代表元的寻找，通过等价类大幅缩小要探索的状态空间，提高求解效率

总的原则：
能确定的确定，不确定的提出可能的方案，然后依次试验尝试
目的：
1. 验证实际的结果与预期的相符
2. 找到担忧结果的的实际例子，例如某些可能的反例（根据实际例子来谈之前担忧的点)

### 分级hash
第一级：
1. 当前颜色结构展开的状态，所有瓶子的顶部边界表
2. 多余颜色数量在单色瓶中的分布 
   3. 在同一类型中，颜色分布不重要，有什么颜色重要，
   用来描述多余颜色的分布情况，
   类型，数量，颜色分布
   问题在于如何生成类型唯一类型
   类型有什么组成：
   2.1. 瓶子高度
   2.2. 瓶子类型
   2.3 瓶子携带的道具
   担忧点： 两个固定瓶，情况A：固定瓶中都有颜色，且是同一种 情况B: 固定瓶中一个有颜色，一个没有
   上述的情况，并非等价盘面，但是在第二级hash无法分辨
2.2 的另外一种理解 单色瓶的状态 {瓶子高度，容纳的颜色，瓶子类型，瓶子携带的道具},然后排序可得到
3. 道具携带情况（非单色瓶中）

> 石膏的担忧点：还需外部的布局表才能确定这个石膏瓶受影响的单色瓶， 
> 石膏角度：左，左右，右
> 受影响的石膏角度： 我完成后，与我关联的石膏瓶对象   i -> 布局 -> 左右 -> 石膏 => 解锁
> 不同位置完善单色瓶 => 导致解锁的石膏对象和数量会是不同的状态
> 哪些是等价的，哪些才是安全的同类型单色瓶聚合
> 石膏：石膏周围的单色瓶完成即可解锁
> 想法1:
> 把受石膏影响的瓶子当前是结果石膏的钥匙，
> 有些瓶子有一把钥匙，有些瓶子有两把钥匙，当作是钥匙和锁的模型处理即刻，只是触发方式不同，只有完成某个颜色才会
> 触发钥匙，这个是钥匙和锁的隐式模型，
> 这要同类型的瓶子聚合条件，优先级顺序：[超集，容量大]，石膏钥匙：关联的瓶子下标[tube_index]



> 实际的探索点：1. 在无障碍物的情况下,这台hash机制是否非常可靠，
> 2. 障碍物的到底影响了哪些情况
> 3. 很重要的一点，障碍物可附着在单色瓶上（包括空瓶，例如帷幕盖在空瓶中)

> state hash 是否合理的的判断条件之一：
> 1. 测试不同等价的合法盘面的 state hash 是否会映射到同一个 hashcode，会出现，就是不合理



#### 在水排序中，什么是等价类
在水排序中，有很多个state，但其中一些状态在“本质上是同一个局面", 只是：
1. 瓶子编号换了（位置交换)
2. 同类型瓶子之间互换（空瓶/单色瓶互换）
3. 某些信息对求解不影响（例如单色瓶里水的具体层级顺序其实没意义，

定义一个等价关系 ~:
A ~ B表示: A 和 B 在允许的“同构变换”下是同一个局面
> 同构变换：不会改变等价类的变化，或者说：变换前与变换后 展开的状态空间一致

一个等价类 [S] 是所有和 S 等价的状态集合
代表元 canonical(S) 就是
从 [S] 里挑出一个"唯一且稳定“的状态作为代表
使得 S1 ～ S2 <=> canonical(S1) == canonical(S2)

目前的找代表元的操作
1. 同类型单色瓶的聚合 （聚合方向不一定是双向等价的，现默认先颜色多的聚合)且聚合后要能够腾出空瓶
2. 单色瓶 -> 非单色瓶的聚合，要腾出空瓶 
> 担忧点： 对于石膏这类对完成瓶的位置敏感的障碍物，暂时无法对其所影响的单色瓶很好的分类和hash；
> 没有找到那个可以切分语义的点

#### 水排序里最常用的等价关系
2.1 最核心: 瓶子置换同构(Tube Permutation)
如果你把瓶子编号全部重排，但每个瓶子的内容没变：
- 求解难度
- 是否可解
- 最短步数(在不计瓶子编号的意义时)
- 结构性质
都不应该改变
瓶子编号是“外在坐标”，不是本质结构

#### 2.2 三类瓶子
##### A) 空瓶（Empty）
内容为空。只关心容量、道具等。

##### B) 单色瓶（Monochrome）
内容形如 [x,x,x,...]
它内部没有结构差异（只剩 “颜色 + 高度 + 道具”）。

##### C) 非单色瓶（Non-mono）
内容形如 [a,b,c,...]
它是“结构核心”，通常需要保留更多信息（至少保留顶部边界/段结构）。

> 核心
> 1. 可排序，且是稳定排序才行
> 2. 可hash 



